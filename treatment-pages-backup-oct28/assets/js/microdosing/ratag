(()=>{(function(u,l){let c=[],d=!1,i={items:[],push(e){this.items.unshift(e)},pop(){return this.items.pop()},processor(){this.proc(),setInterval(this.proc,50)},proc(){!r.undef(u._ratagData)&&Array.isArray(u._ratagData)&&i.run(u._ratagData.pop()),i.items.length!==0&&i.run(Array.from(i.pop()))},run(e){if(r.undef(e))return;let t=e[0];r.undef(h[t])||(r.log("command",e),r.safe(()=>{h[t](...Array.prototype.slice.call(e,1))}))}},h={debug(e){!r.undef(e)&&e===!0&&(d=!0)},errors(){r.log("errors",c)},conversion(e){if(r.undef(e)||r.undef(e.to))return;let t=e.cid;if(r.undef(t)&&(t=r.param("_raclid")),!s.valid(t)&&(t=s.getLastFromStore(),!s.valid(t)))return;let n={cid:t,caid:e.to};!r.undef(e.value)&&typeof e.value=="number"&&(n.value=e.value),!r.undef(e.sub_id)&&typeof e.sub_id=="string"&&(n.sub_id=e.sub_id),r.safe(()=>r.post("https://d4.ads.rmbl.ws/convert",n,e.callback))}},g={set(e,t){[()=>{localStorage[e]=t},()=>{sessionStorage[e]=t},()=>{let a=new Date;a.setSeconds(a.getSeconds()+864e4),l.cookie=e+"="+encodeURI(t)+"; path=/; expires="+a.toUTCString()}].forEach(function(a){r.safe(a)})},get(e){let t=!1,n=[()=>localStorage[e],()=>sessionStorage[e],()=>{let o=("; "+l.cookie).split("; "+e+"=");if(o.length===2)return o.pop().split(";").shift()}];for(let a=0;a<n.length;a++)if(t=r.safe(n[a]),!r.undef(t)&&t!==!1)return t;return""}},s={key:"_cids",regex:/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/i,valid(e){return r.undef(e)||e===null||typeof e=="string"&&e.length===0?!1:this.regex.test(e)},get(){let e=g.get(s.key);return e.length===0?e="[]":e=atob(e),JSON.parse(e)},set(e){r.log("save cid data",e),g.set(s.key,btoa(JSON.stringify(e)))},clean(){let e=r.unixTsSeconds();this.set(this.get().filter(t=>s.valid(t.c)&&!r.undef(t.x)&&t.x>e))},saveForLater(){let e=r.param("_raclid");if(!s.valid(e))return;r.log("save cid",e);let t=s.get(),n=r.unixTsSeconds();for(let a=0;a<t.length;a++)if(!r.undef(t[a].c)&&t[a].c===e)return;t.length>5&&(t=t.slice(-4)),t.push({c:e,x:n+90*24*60*60}),s.set(t.filter(a=>!r.undef(a.x)&&a.x>n))},getLastFromStore(){let e=s.get();if(e.length===0)return null;let n=e.filter(a=>a.c).sort((a,o)=>o.x-a.x).shift();return!n||!n.c?null:n.c}},r={log(){d&&console.log(...arguments)},xhr(e,t,n){return t=new URL(t),this.safe(()=>{let a=null;if(!r.undef(n.data)&&typeof n.data=="object")switch(e){case"GET":Object.keys(n.data).forEach(f=>{t.searchParams.set(f,n.data[f])});break;case"POST":a=r.toFormData(n.data)}let o=new XMLHttpRequest;o.open(e,t.toString()),["onload","onerror","onprogress"].forEach(f=>{r.undef(n[f])||(o[f]=function(){n[f](o,arguments)})}),o.onreadystatechange=()=>{o.readyState===4&&!r.undef(n.callback)&&typeof n.callback=="function"&&n.callback()},o.send(a)})},beacon(e,t){return this.undef(navigator)||this.undef(navigator.sendBeacon)?this.xhr("POST",e,{data:t}):navigator.sendBeacon(e,this.toFormData(t))},post(e,t,n){return this.xhr("POST",e,{data:t,callback:n})},toFormData(e){let t=new FormData;return Object.keys(e).forEach(n=>{t.set(n,e[n])}),t},param(e){return this.undef(this.searchParams)&&(this.searchParams=new URLSearchParams(window.location.search)),this.searchParams.get(e)},safe(e){try{return e()}catch(t){return c.push({error:t,ts:new Date().getTime()}),t}},undef(e){return typeof e>"u"},errors(){return c},unixTsSeconds(){return Math.floor(Date.now()/1e3)}};i.processor(),s.clean(),s.saveForLater(),u.ratag=function(){i.push(arguments)}})(window,document);})();
